<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Minecraft Tierlist - Crystals</title>
<style>
  body {
    background-image: url("icons/thumb-1920-478314.png");
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    margin: 0;
    font-family: Arial, sans-serif;
    text-align: center;
    padding: 20px;
  }
  .box-container {
    display: flex;
    justify-content: center;
    gap: 20px;
    flex-wrap: wrap;
  }
  .box {
    width: 250px;
    min-height: 500px;
    background-color: #1e1e1e;
    color: white;
    font-size: 18px;
    border-radius: 10px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    display: flex;
    flex-direction: column;
    text-align: center;
    padding-top: 50px;
    position: relative;
  }
  .box > .title {
    position: absolute;
    top: 0;
    width: 100%;
    font-weight: bold;
    font-size: 32px;
    padding: 10px 0;
    border-top-left-radius: 10px;
    border-top-right-radius: 10px;
  }
  #tier1-box .title { background-color: #b3a815; color: #fff200; }
  #tier2-box .title { background-color: #a0a0a0; color: #fff; }
  #tier3-box .title { background-color: #854f00; color: #693000; }
  #tier4-box .title, #tier5-box .title { background-color: #414141; color: #fff; }

  .player-box {
    background-color: #3a3a3a;
    color: white;
    padding: 8px 12px;
    margin: 6px auto;
    border-radius: 10px;
    font-size: 16px;
    width: 215px;
    cursor: default;
    user-select: none;
  }
  .player-box.high-tier {
    background-color: #4e4e4e;
  }
  .player-box.low-tier {
    background-color: #363636;
  }
</style>
</head>
<body>

<h1>Minecraft Tierlist - CRYSTALS Kit</h1>

<div class="box-container">
  <div class="box" id="tier1-box">
    <div class="title">Tier 1</div>
  </div>
  <div class="box" id="tier2-box">
    <div class="title">Tier 2</div>
  </div>
  <div class="box" id="tier3-box">
    <div class="title">Tier 3</div>
  </div>
  <div class="box" id="tier4-box">
    <div class="title">Tier 4</div>
  </div>
  <div class="box" id="tier5-box">
    <div class="title">Tier 5</div>
  </div>
</div>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyDziQ1jdojoUwYDUpGLNfbzMDh5-iB1QIQ",
    authDomain: "yugotiers-b297d.firebaseapp.com",
    projectId: "yugotiers-b297d",
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  const tierBoxes = {
    T1: document.getElementById("tier1-box"),
    T2: document.getElementById("tier2-box"),
    T3: document.getElementById("tier3-box"),
    T4: document.getElementById("tier4-box"),
    T5: document.getElementById("tier5-box")
  };

  function clearTierBoxes() {
    Object.values(tierBoxes).forEach(box => {
      while (box.children.length > 1) {
        box.removeChild(box.lastChild);
      }
    });
  }

  function updatePlayers(players) {
    clearTierBoxes();

    const grouped = { T1: [], T2: [], T3: [], T4: [], T5: [] };

    players.forEach(player => {
      if (!player.tiers) return;
      const crystalTier = player.tiers.find(t => t.kit === "CRYSTALS");
      if (!crystalTier) return;

      const tierStr = crystalTier.tier.toUpperCase();
      if (tierStr.startsWith("RH") || tierStr.startsWith("RL")) return;

      let tierKey = null;
      if (tierStr.includes("T1")) tierKey = "T1";
      else if (tierStr.includes("T2")) tierKey = "T2";
      else if (tierStr.includes("T3")) tierKey = "T3";
      else if (tierStr.includes("T4")) tierKey = "T4";
      else if (tierStr.includes("T5")) tierKey = "T5";
      else return;

      grouped[tierKey].push({
        name: player.name || "Unknown",
        tier: tierStr,
        peak: crystalTier.peakTier || ""
      });
    });

    Object.keys(grouped).forEach(tierKey => {
      grouped[tierKey].sort((a, b) => {
        const aHT = a.tier.startsWith("HT") ? 0 : 1;
        const bHT = b.tier.startsWith("HT") ? 0 : 1;
        if (aHT !== bHT) return aHT - bHT;
        return a.name.localeCompare(b.name);
      });

      grouped[tierKey].forEach(p => {
        const div = document.createElement("div");
        div.className = "player-box";
        if (p.tier.startsWith("HT")) div.classList.add("high-tier");
        else if (p.tier.startsWith("LT")) div.classList.add("low-tier");

        div.textContent = p.name;
        if (p.peak && p.peak.trim() !== "") {
          div.title = `Peak Tier: ${p.peak}`;
        }
        tierBoxes[tierKey].appendChild(div);
      });
    });
  }

  db.collection("players").onSnapshot(snapshot => {
    const players = [];
    snapshot.forEach(doc => {
      players.push(doc.data());
    });
    updatePlayers(players);
  });
</script>

</body>
</html>
